require=function t(a,n,o){function r(s,e){if(!n[s]){if(!a[s]){var c="function"==typeof require&&require;if(!e&&c)return c(s,!0);if(i)return i(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var _=n[s]={exports:{}};a[s][0].call(_.exports,function(t){var n=a[s][1][t];return r(n?n:t)},_,_.exports,t,a,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({character:[function(t,a,n){"use strict";cc._RF.push(a,"82712qr6DdCy5m8JbJa0U2O","character"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){},jumpCharacter:function(){this._isJumping=!0;var t=this,a=cc.jumpBy(.15,0,0,50,1),n=cc.jumpBy(.15,0,0,20,1),o=cc.callFunc(function(){t._isJumping=!1},this);this.node.runAction(cc.sequence(a,n,o))}}),cc._RF.pop()},{}],main:[function(t,a,n){"use strict";cc._RF.push(a,"40f34qUqWFDbrw3+HW3UsEJ","main");var o=t("character");cc.Class({"extends":cc.Component,properties:{talkText:{"default":null,type:cc.Label}},onLoad:function(){this.canvas=cc.find("Canvas"),this.initial_time=-.5,this.charaTimer=this.initial_time,this.textTimer=0,this.showCharaFin=!1,this.showTextFin=!1,this.scenarioRunning=!1,this.now_story_no=0,this.count_for_tmp=0,this.now_scenario_no=0,this.now_talk_no=0,this.story_no_onclick=0,this.talkText.string="",this.tmp="";var t=this,a=cc.url.raw("resources/dataJson.json");cc.loader.load(a,function(a,n){null===a&&(t.dataJson=n,t.total_story_num=t.dataJson.story.length,t.total_scenario_num=t.dataJson.story[t.now_story_no].scenario.length,t.total_talk_num=t.dataJson.story[t.now_story_no].scenario[t.now_scenario_no].talk.length,t.story_no_onclick=t.now_story_no,t.character_on=!0,t.scenarioRunning=!0,t.ary_chara_and_node=t.getNowCharacterAndNode(),t.finish_load_json=!0)}),this.setTouchEvent()},loadImgFromUrl:function(t){var a=new cc.Node,n=a.addComponent(cc.Sprite);n.spriteFrame=new cc.SpriteFrame(t);for(var r=0;r<this.dataJson.character.length;r++)if(this.dataJson.character[r].url==t.url){n.c_no=this.dataJson.character[r].no;break}n.addComponent(o),a.parent=this.canvas,n.trim=!1,n.node.active=!1;var i=n.node.width;n.node.width=330,n.node.height*=n.node.width/i,n.node.y=50,this.canvas.children[this.dataJson.character.length-1]&&(this.finish_load_character=!0)},loadImgFromRes:function(t){var a=new cc.Node,n=a.addComponent(cc.Sprite),r=cc.url.raw(t),i=cc.textureCache.addImage(r);n.spriteFrame=new cc.SpriteFrame(i);for(var s=0;s<this.dataJson.character.length;s++)if(this.dataJson.character[s].url==t){n.c_no=this.dataJson.character[s].no;break}n.addComponent(o),a.parent=this.canvas,n.trim=!1,n.node.active=!1;var e=n.node.width;n.node.width=330,n.node.height*=n.node.width/e,n.node.y=50,this.canvas.children[this.dataJson.character.length-1]&&(this.finish_load_character=!0)},setTouchEvent:function(){var t=this;cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouch:!0,onTouchBegan:function(a,n){if(t.charaTimer=t.initial_time,t.textTimer=0,t.now_story_no==t.total_story_num)return cc.find("clickIcon").active=!1,void(t.talkText.string="");if(t.total_story_num=t.dataJson.story.length,t.total_scenario_num=t.dataJson.story[t.now_story_no].scenario.length,1==t.scenarioRunning){t.scenarioRunning=!1,t.showCharaFin=!0,t.showTextFin=!0;for(var o=0;o<t.total_scenario_num;o++)t.setCharacterToNode(t.ary_chara_and_node[o][0],t.ary_chara_and_node[o][1]);for(var o=0;o<t.total_scenario_num;o++)t.now_character=t.dataJson.story[t.now_story_no].scenario[o].character_no,t.characters[t.now_character-1].active=!0,t.characters[t.now_character-1].opacity=255;t.tmp="";for(var o=0;o<t.total_scenario_num;o++)for(var r=t.now_talk_no;r<t.dataJson.story[t.now_story_no].scenario[o].talk.length;r++)t.tmp+=t.dataJson.story[t.now_story_no].scenario[o].talk[r]+"\n";t.talkText.string=t.tmp,t.now_talk_no=0,t.now_scenario_no=0,t.now_story_no++,t.count_for_tmp=0,cc.find("clickIcon").active=!0}else if(0==t.scenarioRunning){cc.find("clickIcon").active=!1,t.story_no_onclick=t.now_story_no,t.character_on=!0,t.talkText.string="",t.tmp="";for(var o=0;o<t.dataJson.character.length;o++)t.characters[t.characters_no_ary[o]-1].active=!1;t.showCharaFin=!1,t.showTextFin=!1,t.scenarioRunning=!0,t.ary_chara_and_node=t.getNowCharacterAndNode()}return!0}},t.node)},update:function(t){if(void 0!==this.dataJson){if(this.finish_load_json){this.finish_load_json=!1;for(var a=0;a<this.dataJson.character.length;a++){var n=this.dataJson.character[a].url;if("resources/"==n.substr(0,10))this.loadImgFromRes(n);else{var r=n;cc.textureCache.addImageAsync(r,this.loadImgFromUrl,this)}}}if(void 0!==this.canvas.children[this.dataJson.character.length-1]){if(this.finish_load_character){this.finish_load_character=!1,this.characters=[],this.characters_no_ary=[];for(var a=0;a<this.dataJson.character.length;a++)this.characters[this.canvas.children[a].getComponent(cc.Sprite).c_no-1]=this.canvas.children[a],this.characters_no_ary[a]=this.canvas.children[a].getComponent(cc.Sprite).c_no}if(this.scenarioRunning&&(this.character_on&&!this.showCharaFin&&(this.charaTimer>=1&&(this.charaTimer=1,this.showCharaFin=!0),this.charaTimer==this.initial_time&&(this.setCharacterToNode(this.ary_chara_and_node[this.now_scenario_no][0],this.ary_chara_and_node[this.now_scenario_no][1]),this.total_talk_num=this.dataJson.story[this.now_story_no].scenario[this.now_scenario_no].talk.length),this.charaTimer>=0&&(this.now_character=this.dataJson.story[this.now_story_no].scenario[this.now_scenario_no].character_no,this.characters[this.now_character-1].active=!0,this.characters[this.now_character-1].opacity=100+155*this.charaTimer),1==this.charaTimer&&this.characters[this.now_character-1].getComponent(o).jumpCharacter(),this.charaTimer+=t,this.textTimer=0,this.showTextFin=!1),this.showCharaFin&&!this.showTextFin)){this.writeText();var i=this.dataJson.story[this.now_story_no].scenario[this.now_scenario_no].talk[this.now_talk_no],s=i.split(""),e=Math.floor(this.textTimer/.15);e==s.length&&(this.now_talk_no++,this.count_for_tmp=0,this.now_talk_no==this.total_talk_num&&(this.now_talk_no=0,this.now_scenario_no++,this.now_scenario_no==this.total_scenario_num&&(this.now_scenario_no=0,this.now_story_no++)),this.showTextFin=!0,this.showCharaFin=!1),this.story_no_onclick+1==this.now_story_no&&(this.scenarioRunning=!1,this.character_on=!1,cc.find("clickIcon").active=!0),this.textTimer+=t,this.charaTimer=this.initial_time}}}},writeText:function(){this.story_no_onclick==this.now_story_no&&0==this.count_for_tmp&&(""!=this.talkText.string&&(this.tmp=this.talkText.string),this.count_for_tmp++),this.talkText.string="";for(var t=this.dataJson.story[this.now_story_no].scenario[this.now_scenario_no].talk[this.now_talk_no],a=t.split(""),n=[],o=Math.floor(this.textTimer/.15),r=0;r<o;r++)n.push(a[r]);o==a.length&&n.push("\n"),this.text_tmp=n.join(""),this.text=this.tmp+this.text_tmp,this.talkText.string=this.text},getNowCharacterAndNode:function(){for(var t=[],a=0;a<this.dataJson.story[this.now_story_no].scenario.length;a++){var n=[this.dataJson.story[this.now_story_no].scenario[a].character_no,this.dataJson.story[this.now_story_no].scenario[a].node_no];t.push(n)}return t},setCharacterToNode:function(t,a){switch(a){case 1:this.characters[t-1].x=-350;break;case 2:this.characters[t-1].x=0;break;case 3:this.characters[t-1].x=350;break;case 4:this.characters[t-1].x=-250;break;case 5:this.characters[t-1].x=250;break;default:return}}}),cc._RF.pop()},{character:"character"}]},{},["character","main"]);